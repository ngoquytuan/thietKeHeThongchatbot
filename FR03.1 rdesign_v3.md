- **FR-03.1** nÃªn táº¡o ra output cÃ³ Ä‘á»‹nh dáº¡ng chuáº©n vá»›i cÃ¡c trÆ°á»ng thÃ´ng tin quan trá»ng Ä‘á»ƒ **FR-03.3** cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ phÃ¡t hiá»‡n trÃ¹ng láº·p hiá»‡u quáº£. HÃ£y thiáº¿t káº¿ má»™t **schema output chuáº©n** cho module nÃ y:

## ğŸ¯ **SCHEMA OUTPUT Cá»¦A FR-03.1**

### **Äá» xuáº¥t format: JSONL (JSON Lines) + Metadata JSON**

**Táº¡i sao JSONL?**
- âœ… Dá»… Ä‘á»c tuáº§n tá»± (streaming)
- âœ… Xá»­ lÃ½ Ä‘Æ°á»£c file lá»›n
- âœ… Dá»… import vÃ o database
- âœ… Structured nhÆ°ng váº«n human-readable

### **1. Cáº¥u trÃºc Output Package**

```bash
output_package/
â”œâ”€â”€ document_content.jsonl      # Ná»™i dung chÃ­nh
â”œâ”€â”€ metadata.json              # Metadata tá»•ng thá»ƒ
â”œâ”€â”€ processing_info.json       # ThÃ´ng tin xá»­ lÃ½
â”œâ”€â”€ assets/                    # Files Ä‘Ã­nh kÃ¨m
â”‚   â”œâ”€â”€ image_001.png
â”‚   â””â”€â”€ diagram_001.svg
â””â”€â”€ checksums.json            # Hash values cho verification
```

### **2. Schema chi tiáº¿t**

#### **ğŸ“„ document_content.jsonl**
```jsonl
{"chunk_id": "DOC_001_CHUNK_001", "content": "Quy trÃ¬nh mua hÃ ng cá»§a cÃ´ng ty bao gá»“m 5 bÆ°á»›c chÃ­nh...", "chunk_order": 1, "chunk_type": "content", "word_count": 245}
{"chunk_id": "DOC_001_CHUNK_002", "content": "BÆ°á»›c 1: Táº¡o yÃªu cáº§u mua hÃ ng (Purchase Request)...", "chunk_order": 2, "chunk_type": "procedure_step", "word_count": 189}
{"chunk_id": "DOC_001_CHUNK_003", "content": "BÆ°á»›c 2: PhÃª duyá»‡t tá»« trÆ°á»Ÿng phÃ²ng...", "chunk_order": 3, "chunk_type": "procedure_step", "word_count": 156}
```

#### **ğŸ“‹ metadata.json**
```json
{
  "document_info": {
    "document_id": "PROCUREMENT_GUIDE_2025_V1",
    "title": "HÆ°á»›ng dáº«n Quy trÃ¬nh Mua hÃ ng 2025",
    "description": "TÃ i liá»‡u hÆ°á»›ng dáº«n chi tiáº¿t quy trÃ¬nh mua hÃ ng trong cÃ´ng ty",
    "version": "1.0",
    "language": "vi",
    "document_type": "procedure",
    "category": "procurement",
    "subcategory": "purchasing_process"
  },
  
  "source_info": {
    "original_filename": "Quy_trinh_mua_hang_2025.docx",
    "source_file_path": "/uploads/2025/procurement/Quy_trinh_mua_hang_2025.docx",
    "file_size_bytes": 2847392,
    "file_extension": ".docx",
    "mime_type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    "upload_timestamp": "2025-09-06T14:30:00Z"
  },
  
  "content_fingerprints": {
    "file_hash_sha256": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
    "content_hash_sha256": "b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9",
    "content_hash_md5": "5d41402abc4b2a76b9719d911017c592",
    "simhash_64bit": "18446744073709551615",
    "text_length_chars": 12500,
    "text_length_words": 2450,
    "estimated_tokens": 3200
  },
  
  "ownership_access": {
    "department_owner": "procurement",
    "author": "Nguyá»…n VÄƒn A",
    "reviewer": "Tráº§n Thá»‹ B", 
    "approver": "LÃª VÄƒn C",
    "access_level": "employee_only",
    "created_by": "user_12345",
    "created_at": "2025-09-06T14:30:00Z",
    "last_updated": "2025-09-06T14:30:00Z"
  },
  
  "classification": {
    "tags": ["mua-hÃ ng", "quy-trÃ¬nh", "phÃª-duyá»‡t", "procurement", "workflow"],
    "keywords_extracted": ["quy trÃ¬nh", "mua hÃ ng", "phÃª duyá»‡t", "yÃªu cáº§u", "giÃ¡m Ä‘á»‘c"],
    "content_type": "structured_procedure",
    "sensitivity_level": "internal",
    "retention_period_months": 60
  },
  
  "processing_metadata": {
    "processed_by": "FR-03.1",
    "processing_version": "1.0",
    "processing_timestamp": "2025-09-06T14:35:00Z",
    "processing_duration_seconds": 45.7,
    "quality_score": 0.92,
    "warnings": [],
    "errors": []
  }
}
```

#### **âš™ï¸ processing_info.json**
```json
{
  "processing_status": "completed",
  "ready_for_ingestion": true,
  "ingestion_priority": "normal",
  
  "content_analysis": {
    "total_chunks": 25,
    "chunk_size_avg": 487,
    "chunk_size_std": 82,
    "content_structure": {
      "headers": 8,
      "paragraphs": 45,
      "lists": 12,
      "tables": 3,
      "images": 2
    }
  },
  
  "duplicate_detection_prep": {
    "file_signatures": {
      "sha256": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
      "md5": "5d41402abc4b2a76b9719d911017c592",
      "crc32": "414fa339"
    },
    "content_signatures": {
      "normalized_text_hash": "b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9",
      "simhash": "18446744073709551615",
      "minhash": ["hash1", "hash2", "hash3", "..."],
      "keyword_fingerprint": "procurement,workflow,approval,director"
    },
    "similarity_features": {
      "filename_normalized": "quy_trinh_mua_hang_2025",
      "title_normalized": "huong_dan_quy_trinh_mua_hang_2025", 
      "key_phrases": ["quy trÃ¬nh mua hÃ ng", "phÃª duyá»‡t giÃ¡m Ä‘á»‘c", "yÃªu cáº§u mua hÃ ng"],
      "document_structure_signature": "header-list-procedure-table-conclusion"
    }
  },
  
  "embedding_prep": {
    "model_recommended": "Qwen/Qwen3-Embedding-0.6B",
    "chunking_strategy": "semantic_sentence_boundary",
    "overlap_percentage": 10,
    "estimated_embedding_time_seconds": 12.5,
    "estimated_storage_mb": 2.8
  },
  
  "next_steps": {
    "target_module": "FR-03.3",
    "expected_processing_time_minutes": 5,
    "dependencies": ["vector_db_ready", "postgres_connection"],
    "validation_required": false
  }
}
```

#### **ğŸ” checksums.json**
```json
{
  "package_integrity": {
    "package_created": "2025-09-06T14:35:00Z",
    "total_files": 4,
    "total_size_bytes": 2891847
  },
  "file_checksums": {
    "document_content.jsonl": {
      "sha256": "c1234567890abcdef...",
      "md5": "d1234567890abcdef...",
      "size_bytes": 125000
    },
    "metadata.json": {
      "sha256": "e1234567890abcdef...",
      "md5": "f1234567890abcdef...",
      "size_bytes": 8500
    },
    "processing_info.json": {
      "sha256": "g1234567890abcdef...",
      "md5": "h1234567890abcdef...",
      "size_bytes": 3200
    }
  }
}
```

## ğŸ”„ **Workflow Integration vá»›i FR-03.3**

```mermaid
graph TB
    subgraph "FR-03.1 Output"
        JSONL[ğŸ“„ document_content.jsonl<br/>Structured content]
        META[ğŸ“‹ metadata.json<br/>Complete metadata]
        PROC[âš™ï¸ processing_info.json<br/>Processing details]
        CHECK[ğŸ” checksums.json<br/>Integrity verification]
    end
    
    subgraph "FR-03.3 Ingestion Process"
        VALIDATE[âœ… Validate Package<br/>Check integrity]
        DUP_CHECK[ğŸ” Duplicate Detection<br/>Multi-level checking]
        EMBED[ğŸ§  Generate Embeddings<br/>Qwen3-Embedding-0.6B]
        STORE[ğŸ’¾ Store to Databases<br/>PostgreSQL + Vector DB]
    end
    
    subgraph "Duplicate Detection Levels"
        HASH_CHECK[ğŸ” Hash-based Check<br/>file_hash_sha256 + content_hash_sha256]
        SIM_CHECK[ğŸ§® Similarity Check<br/>simhash + minhash]
        SEMANTIC[ğŸ§  Semantic Check<br/>Embedding comparison]
    end
    
    META --> VALIDATE
    CHECK --> VALIDATE
    VALIDATE --> DUP_CHECK
    
    DUP_CHECK --> HASH_CHECK
    DUP_CHECK --> SIM_CHECK  
    DUP_CHECK --> SEMANTIC
    
    HASH_CHECK --> EMBED
    SIM_CHECK --> EMBED
    SEMANTIC --> EMBED
    
    JSONL --> EMBED
    EMBED --> STORE
```

## ğŸ¯ **Key Benefits cá»§a Schema nÃ y**

### **1. Duplicate Detection Optimization**
- **File-level**: `file_hash_sha256` + `file_size_bytes` + `original_filename`
- **Content-level**: `content_hash_sha256` + `simhash_64bit` + `text_length_chars`
- **Semantic-level**: `keyword_fingerprint` + structured content analysis

### **2. Fast Lookup & Comparison**
- Pre-computed hash values
- Normalized filename vÃ  title cho string similarity
- Key phrases extracted Ä‘á»ƒ so sÃ¡nh ngá»¯ nghÄ©a nhanh

### **3. Business Intelligence**
- Complete metadata theo schema FR-01.2
- Processing quality metrics
- Content analysis cho optimization

### **4. System Integration**
- Chuáº©n bá»‹ sáºµn thÃ´ng tin cho embedding generation
- Compatible vá»›i multiple database systems
- Audit trail Ä‘áº§y Ä‘á»§

Báº¡n tháº¥y schema nÃ y cÃ³ phÃ¹ há»£p vá»›i má»¥c tiÃªu cá»§a FR-03.1 vÃ  FR-03.3 khÃ´ng? 
