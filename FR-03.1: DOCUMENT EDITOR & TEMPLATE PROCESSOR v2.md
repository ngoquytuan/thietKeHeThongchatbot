Báº¡n Ä‘Ãºng rá»“i! Sau khi Ä‘á»c tÃ i liá»‡u project, tÃ´i hiá»ƒu rÃµ hÆ¡n vá» má»‘i quan há»‡ giá»¯a cÃ¡c module. HÃ£y cÃ¹ng thiáº¿t káº¿ láº¡i FR-03.1 theo hÆ°á»›ng mÃ  báº¡n Ä‘á» xuáº¥t:

# **ğŸ¯ TÃI THIáº¾T Káº¾ FR-03.1: DOCUMENT EDITOR & TEMPLATE PROCESSOR**

## **ğŸ“‹ PHÃ‚N TÃCH YÃŠU Cáº¦U Má»šI**

### **ğŸ”„ Má»‘i quan há»‡ vá»›i FR-01**
âœ… **Template Schema** pháº£i láº¥y tá»« **FR-01.2** - Cáº¥u trÃºc Metadata chuáº©n
âœ… **Document Types** follow theo Ä‘á»‹nh nghÄ©a trong FR-01: `policy`, `procedure`, `technical_guide`, `report`
âœ… **Metadata Fields** tuÃ¢n theo schema Ä‘Ã£ Ä‘á»‹nh nghÄ©a: `document_id`, `source_file`, `version`, `department_owner`, etc.

### **ğŸ¯ Luá»“ng xá»­ lÃ½ má»›i**
```mermaid
graph LR
    subgraph "ğŸ“¥ INPUT"
        Upload[ğŸ“„ Upload Document<br/>DOC, DOCX, PDF, TXT, MD]
        RawContent[ğŸ“– Raw Content<br/>Unstructured]
    end
    
    subgraph "ğŸŒ WEB EDITOR"
        Parse[ğŸ”§ Parse & Display<br/>Structured View]
        Edit[âœï¸ Web Editor<br/>Live Editing]
        Preview[ğŸ‘ï¸ Live Preview<br/>Real-time]
    end
    
    subgraph "ğŸ“‹ TEMPLATE SYSTEM"
        SelectTemplate[ğŸ¯ Select Template<br/>Based on FR-01 Schema]
        ApplyTemplate[ğŸ“ Apply Template<br/>Metadata + Format]
        Validate[âœ… Validate<br/>Business Rules]
    end
    
    subgraph "ğŸ“¤ OUTPUT"
        StandardMD[ğŸ“ Standard Markdown<br/>+ Metadata Header]
        Export[ğŸ“¦ Export Package<br/>Ready for FR-03.3]
    end
    
    Upload --> Parse
    Parse --> Edit
    Edit --> Preview
    Preview --> SelectTemplate
    SelectTemplate --> ApplyTemplate
    ApplyTemplate --> Validate
    Validate --> StandardMD
    StandardMD --> Export
    
    classDef input fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef editor fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef template fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef output fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    
    class Upload,RawContent input
    class Parse,Edit,Preview editor
    class SelectTemplate,ApplyTemplate,Validate template
    class StandardMD,Export output
```

---

## **ğŸ—ï¸ KIáº¾N TRÃšC MODULE Má»šI**

### **ğŸ“± Frontend: Web Document Editor**
```mermaid
graph TB
    subgraph "ğŸŒ FRONTEND COMPONENTS"
        FileUploader[ğŸ“ File Uploader<br/>Multi-format Support]
        DocumentViewer[ğŸ“– Document Viewer<br/>Rich Text Display]
        LiveEditor[âœï¸ Live Editor<br/>Monaco/CodeMirror]
        MetadataPanel[ğŸ“‹ Metadata Panel<br/>Template-based Form]
        PreviewPane[ğŸ‘ï¸ Preview Pane<br/>Real-time Rendering]
        TemplateSelector[ğŸ¯ Template Selector<br/>FR-01 Schema Based]
        ExportDialog[ğŸ“¦ Export Dialog<br/>Format Options]
    end
    
    subgraph "âš™ï¸ BACKEND SERVICES"
        UploadService[ğŸ“¤ Upload Service]
        ParsingService[ğŸ”§ Parsing Service]
        EditorService[âœï¸ Editor Service]
        TemplateService[ğŸ“‹ Template Service<br/>Connect to FR-01]
        ValidationService[âœ… Validation Service]
        ExportService[ğŸ“¦ Export Service]
    end
    
    FileUploader --> UploadService
    DocumentViewer --> ParsingService
    LiveEditor --> EditorService
    MetadataPanel --> TemplateService
    TemplateSelector --> TemplateService
    PreviewPane --> ValidationService
    ExportDialog --> ExportService
```

---

## **ğŸ“‹ CHECKLIST PHÃT TRIá»‚N Má»šI**

## **ğŸš€ GIAI ÄOáº N 1: SETUP & INTEGRATION**

### **âœ… Environment & Dependencies**
- [ ] **Setup Python 3.10.11** vá»›i all required packages
- [ ] **Install document parsers**: `python-docx`, `PyPDF2`, `markdown`
- [ ] **Frontend framework**: Next.js 18.x cho web editor
- [ ] **Rich text editor**: Monaco Editor hoáº·c TinyMCE
- [ ] **Real-time preview**: Markdown renderer vá»›i live update

### **âœ… Integration vá»›i FR-01**
- [ ] **Connect to FR-01 database** Ä‘á»ƒ láº¥y template definitions
- [ ] **Import metadata schema** tá»« FR-01.2
- [ ] **Sync document types** vÃ  validation rules
- [ ] **Setup API calls** to FR-01 services cho template data

---

## **ğŸš€ GIAI ÄOáº N 2: DOCUMENT PARSING & DISPLAY**

### **âœ… Multi-format Parser**
```python
# Enhanced Document Parser
class DocumentParser:
    def parse_document(self, file_path: str, file_type: str) -> ParsedDocument:
        """Parse document vÃ  extract both content vÃ  structure"""
        if file_type == 'pdf':
            return self._parse_pdf(file_path)
        elif file_type in ['docx', 'doc']:
            return self._parse_docx(file_path)
        elif file_type == 'md':
            return self._parse_markdown(file_path)
        elif file_type == 'txt':
            return self._parse_text(file_path)
    
    def extract_structure(self, content: str) -> DocumentStructure:
        """Extract headers, paragraphs, tables, lists"""
        # Vietnamese text processing vá»›i underthesea
        pass
    
    def suggest_metadata(self, content: str) -> dict:
        """Auto-suggest metadata based on content analysis"""
        pass
```

### **âœ… Web Document Viewer**
- [ ] **Structured display** vá»›i headers, paragraphs hierarchy
- [ ] **Table rendering** preserving original formatting
- [ ] **Image handling** vÃ  embedded media
- [ ] **Vietnamese text** proper rendering vá»›i diacritics
- [ ] **Search vÃ  highlight** functionality

---

## **ğŸš€ GIAI ÄOáº N 3: WEB EDITOR IMPLEMENTATION**

### **âœ… Live Editing Interface**
```typescript
// React component for document editor
interface DocumentEditorProps {
  initialContent: string;
  template: DocumentTemplate; // From FR-01
  onContentChange: (content: string) => void;
  onMetadataChange: (metadata: DocumentMetadata) => void;
}

const DocumentEditor: React.FC<DocumentEditorProps> = ({
  initialContent,
  template,
  onContentChange,
  onMetadataChange
}) => {
  return (
    <div className="editor-layout">
      <MetadataPanel template={template} onChange={onMetadataChange} />
      <ContentEditor content={initialContent} onChange={onContentChange} />
      <LivePreview content={content} metadata={metadata} />
    </div>
  );
};
```

### **âœ… Core Editor Features**
- [ ] **Real-time editing** vá»›i debounced auto-save
- [ ] **Markdown syntax** highlighting vÃ  shortcuts
- [ ] **Vietnamese input** support vá»›i proper IME
- [ ] **Drag & drop** cho images vÃ  files
- [ ] **Collaborative editing** (future enhancement)

---

## **ğŸš€ GIAI ÄOáº N 4: TEMPLATE INTEGRATION**

### **âœ… Template Service tá»« FR-01**
```python
class TemplateIntegrationService:
    def get_available_templates(self) -> List[DocumentTemplate]:
        """Fetch templates tá»« FR-01 database"""
        # API call to FR-01.2 service
        pass
    
    def apply_template(self, 
                      content: str, 
                      metadata: dict, 
                      template_id: str) -> ProcessedDocument:
        """Apply template formatting vÃ  validation"""
        template = self.get_template(template_id)
        
        # Apply metadata schema tá»« FR-01
        validated_metadata = self.validate_metadata(metadata, template)
        
        # Format content theo template structure
        formatted_content = self.format_content(content, template)
        
        return ProcessedDocument(
            content=formatted_content,
            metadata=validated_metadata,
            template_id=template_id
        )
```

### **âœ… Template Features**
- [ ] **Dynamic form generation** based on FR-01 schema
- [ ] **Real-time validation** vá»›i business rules tá»« FR-01
- [ ] **Template preview** cho different document types
- [ ] **Conditional fields** based on document_type selection
- [ ] **Multi-language support** cho Vietnamese/English

---

## **ğŸš€ GIAI ÄOáº N 5: STANDARDIZED OUTPUT**

### **âœ… Markdown vá»›i Metadata Header**
```markdown
---
document_id: "TECH_GUIDE_001_2025"
source_file: "/uploads/api_documentation.pdf"
version: "1.0"
department_owner: "rd"
author: "tech.lead@company.com"
title: "API Documentation Guide"
access_level: "employee_only"
document_type: "technical_guide"
tags: ["api", "documentation", "development"]
created_at: "2025-09-05T10:30:00Z"
last_updated: "2025-09-05T10:30:00Z"
---

# API Documentation Guide

## 1. Giá»›i thiá»‡u
TÃ i liá»‡u nÃ y hÆ°á»›ng dáº«n cÃ¡ch táº¡o vÃ  maintain API documentation...

## 2. Cáº¥u trÃºc API
### 2.1 RESTful Endpoints
...
```

### **âœ… Export Options**
- [ ] **Standard Markdown** (.md) vá»›i YAML frontmatter
- [ ] **JSON Package** chá»©a content + metadata separated
- [ ] **HTML Export** vá»›i styled preview
- [ ] **PDF Export** cho archival purposes
- [ ] **Ready for FR-03.3** ingestion pipeline

---

## **ğŸ”§ CÃ”NG NGHá»† VÃ€ TOOLS**

### **Frontend Stack**
```json
{
  "framework": "Next.js 18.x",
  "editor": "Monaco Editor / CodeMirror",
  "ui": "Tailwind CSS + Headless UI",
  "state": "Zustand / React Query",
  "preview": "Marked.js + Prism.js"
}
```

### **Backend Stack**
```python
# requirements.txt
fastapi>=0.104.0
python-multipart>=0.0.6
python-docx>=0.8.11
PyPDF2>=3.0.1
markdown>=3.5.1
underthesea>=6.7.0
pyvi>=0.1.1
sentence-transformers>=2.2.2
```

---

## **ğŸ¯ OUTPUT CHUáº¨N CHO FR-03.3**

### **ğŸ“¦ Export Package Structure**
```
output/
â”œâ”€â”€ document.md              # Main content vá»›i metadata header
â”œâ”€â”€ metadata.json           # Structured metadata cho database
â”œâ”€â”€ assets/                 # Images, attachments
â”‚   â”œâ”€â”€ image1.png
â”‚   â””â”€â”€ diagram1.svg
â””â”€â”€ processing_info.json    # Info cho FR-03.3 ingestion
```

### **ğŸ“„ Processing Info for FR-03.3**
```json
{
  "document_id": "TECH_GUIDE_001_2025",
  "processing_status": "ready_for_ingestion",
  "content_file": "document.md",
  "metadata_file": "metadata.json",
  "assets_count": 2,
  "content_stats": {
    "word_count": 1250,
    "estimated_tokens": 1680,
    "suggested_chunk_size": 512,
    "language": "vi"
  },
  "quality_checks": {
    "metadata_complete": true,
    "content_structured": true,
    "vietnamese_processed": true,
    "ready_for_embedding": true
  }
}
```

---

## **ğŸŒŸ KEY BENEFITS**

1. **ğŸ”— Seamless Integration** vá»›i FR-01 metadata schema
2. **âœï¸ User-friendly** web editor cho content creation/editing  
3. **ğŸ“‹ Template-driven** processing Ä‘áº£m báº£o consistency
4. **ğŸ‡»ğŸ‡³ Vietnamese-optimized** text processing
5. **ğŸ“¤ Standardized output** ready cho FR-03.3 ingestion
6. **âš¡ Real-time preview** Ä‘á»ƒ ensure quality trÆ°á»›c khi export

Thiáº¿t káº¿ nÃ y sáº½ táº¡o ra má»™t cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ transform raw documents thÃ nh clean, structured content sáºµn sÃ ng cho RAG system, vá»›i user experience tá»‘t vÃ  integration cháº·t cháº½ vá»›i toÃ n bá»™ há»‡ thá»‘ng!
